from flask import Flask, request, jsonify
import time
import os

app = Flask(__name__)

# Dit onthoudt de locaties van alle spelers
players = {}

@app.route('/update', methods=['POST'])
def update():
    data = request.json
    user = data.get("user")
    
    # Sla de gegevens van de speler op
    players[user] = {
        "x": data.get("x"), 
        "y": data.get("y"),
        "has_car": data.get("has_car", False), 
        "last_seen": time.time()
    }
    
    # Verwijder spelers die langer dan 15 seconden offline zijn
    now = time.time()
    for name in list(players.keys()):
        if now - players[name]["last_seen"] > 15:
            del players[name]
            
    return jsonify({"all_players": players})

@app.route('/')
def home():
    return "Tamagotchi Online Server is LIVE!"

if __name__ == "__main__":
    # Render geeft ons een poort via een omgevingsvariabele
    port = int(os.environ.get("PORT", 5000))
    app.run(host='0.0.0.0', port=port)